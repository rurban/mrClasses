<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mrClasses: mrSampler.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mrSampler.h</h1><a href="mrSampler_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//  Copyright (c) 2004, Gonzalo Garramuno</span>
00003 <span class="comment">//</span>
00004 <span class="comment">//  All rights reserved.</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  Redistribution and use in source and binary forms, with or without</span>
00007 <span class="comment">//  modification, are permitted provided that the following conditions are</span>
00008 <span class="comment">//  met:</span>
00009 <span class="comment">//  *       Redistributions of source code must retain the above copyright</span>
00010 <span class="comment">//  notice, this list of conditions and the following disclaimer.</span>
00011 <span class="comment">//  *       Redistributions in binary form must reproduce the above</span>
00012 <span class="comment">//  copyright notice, this list of conditions and the following disclaimer</span>
00013 <span class="comment">//  in the documentation and/or other materials provided with the</span>
00014 <span class="comment">//  distribution.</span>
00015 <span class="comment">//  *       Neither the name of Gonzalo Garramuno nor the names of</span>
00016 <span class="comment">//  its other contributors may be used to endorse or promote products derived</span>
00017 <span class="comment">//  from this software without specific prior written permission. </span>
00018 <span class="comment">//</span>
00019 <span class="comment">//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
00020 <span class="comment">//  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
00021 <span class="comment">//  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
00022 <span class="comment">//  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
00023 <span class="comment">//  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00024 <span class="comment">//  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00025 <span class="comment">//  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
00026 <span class="comment">//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
00027 <span class="comment">//  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
00028 <span class="comment">//  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
00029 <span class="comment">//  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00030 <span class="comment">//</span>
00031 
00032 <span class="preprocessor">#ifndef mrSampler_h</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define mrSampler_h</span>
00034 <span class="preprocessor"></span>
00035 
00036 <span class="preprocessor">#ifndef mrVector_h</span>
00037 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="mrVector_8h.html">mrVector.h</a>"</span>
00038 <span class="preprocessor">#endif</span>
00039 <span class="preprocessor"></span>
00040 
00041 <a class="code" href="mrMacros_8h.html#a0">BEGIN_NAMESPACE</a>( mr )
00042 
00043 <span class="comment">// Usage:</span>
00044 <span class="comment">//</span>
00045 <span class="comment">// /* This example samples 16 times around the hemisphere </span>
00046 <span class="comment">//    of the normal with a cosine distribution */</span>
00047 <span class="comment">//</span>
00048 <span class="comment">// hemisphereSampler g( state-&gt;normal, 16 );</span>
00049 <span class="comment">//</span>
00050 <span class="comment">// color result( kNoInit );</span>
00051 <span class="comment">// color CKd;</span>
00052 <span class="comment">//</span>
00053 <span class="comment">// while ( g.cosine() )</span>
00054 <span class="comment">// {</span>
00055 <span class="comment">//     if ( mi_trace_reflection( result, state, &amp;g.direction() ) )</span>
00056 <span class="comment">//     {</span>
00057 <span class="comment">//         CKd += result;</span>
00058 <span class="comment">//     }</span>
00059 <span class="comment">// }</span>
00060 <span class="comment">//</span>
00061 <span class="comment">// CKd /= g.count();</span>
00062 <span class="comment">//</span>
00063 <span class="comment">//</span>
00065 <span class="comment"></span><span class="comment">//</span>
00066 <span class="comment">// /* This example samples 16 times around the hemisphere </span>
00067 <span class="comment">//    of the normal with a uniform distribution.</span>
00068 <span class="comment">//    It uses a sphereSampler, with a 0.5f percentage (ie. hemisphere).</span>
00069 <span class="comment">//    This approach works only for uniform sampling and is faster than</span>
00070 <span class="comment">//    the actual hemisphereSampler.</span>
00071 <span class="comment">// */</span>
00072 <span class="comment">//</span>
00073 <span class="comment">// sphereSampler g( state-&gt;normal, 16, 0.5f );</span>
00074 <span class="comment">//</span>
00075 <span class="comment">// color result( kNoInit );</span>
00076 <span class="comment">// color CKd;</span>
00077 <span class="comment">//</span>
00078 <span class="comment">// while ( g.uniform(state) )</span>
00079 <span class="comment">// {</span>
00080 <span class="comment">//     if ( mi_trace_reflection( result, state, &amp;g.direction() ) )</span>
00081 <span class="comment">//     {</span>
00082 <span class="comment">//         CKd += result;</span>
00083 <span class="comment">//     }</span>
00084 <span class="comment">// }</span>
00085 <span class="comment">//</span>
00086 <span class="comment">// CKd /= g.count();</span>
00087 <span class="comment">//</span>
00088 <span class="comment">//</span>
00090 <span class="comment"></span><span class="comment">//</span>
00091 <span class="comment">// /* This example samples X times around the hemisphere </span>
00092 <span class="comment">//    of the normal with a uniform distribution.</span>
00093 <span class="comment">//    The sampling is done adaptively (ie. there is no </span>
00094 <span class="comment">//    maximum number of samples taken and constructor is</span>
00095 <span class="comment">//    initialized as such ) */</span>
00096 <span class="comment">//</span>
00097 <span class="comment">// hemisphereSampler g( state-&gt;normal );</span>
00098 <span class="comment">//</span>
00099 <span class="comment">// color    result( kNoInit );</span>
00100 <span class="comment">// color oldResult( -1.0f );</span>
00101 <span class="comment">// color CKd;</span>
00102 <span class="comment">//</span>
00103 <span class="comment">// while ( g.uniform(state) )</span>
00104 <span class="comment">// {</span>
00105 <span class="comment">//     if ( mi_trace_reflection( result, state, &amp;g.direction() ) )</span>
00106 <span class="comment">//     {</span>
00107 <span class="comment">//         CKd += result;</span>
00108 <span class="comment">//     }</span>
00109 <span class="comment">//     // Do adaptive sampling after 4 samples</span>
00110 <span class="comment">//     if ( g.count() &gt; 4 )</span>
00111 <span class="comment">//     {</span>
00112 <span class="comment">//         color diff = result / g.count() - oldResult;</span>
00113 <span class="comment">//         if ( diff &lt; 0.1 ) break;</span>
00114 <span class="comment">//         oldResult = result;</span>
00115 <span class="comment">//     }</span>
00116 <span class="comment">// }</span>
00117 <span class="comment">//</span>
00118 <span class="comment">// CKd /= g.count();</span>
00119 <span class="comment">//</span>
00121 <span class="comment"></span><span class="comment">//</span>
00122 <span class="comment">// Besides hemisphere and sphere, there's also disk and </span>
00123 <span class="comment">// cone samplers, with a similar interface.</span>
00124 <span class="comment">//</span>
00125 
00126 
00127 <span class="comment">// ....base class for all samplers....</span>
<a name="l00128"></a><a class="code" href="structmr_1_1sampler.html">00128</a> <span class="keyword">struct </span><a class="code" href="structmr_1_1sampler.html">sampler</a>
00129 {
00130   <span class="comment">// In parameters</span>
<a name="l00131"></a><a class="code" href="structmr_1_1sampler.html#o0">00131</a>   <span class="keyword">const</span> miUint*   maxSamples;
00132 
00133   <span class="comment">// mi_sample() counter</span>
<a name="l00134"></a><a class="code" href="structmr_1_1sampler.html#o1">00134</a>   <span class="keywordtype">int</span> counter;
00135 
00137   <span class="keyword">inline</span> <a class="code" href="structmr_1_1sampler.html">sampler</a>();
00139   <span class="keyword">inline</span> <a class="code" href="structmr_1_1sampler.html">sampler</a>( <span class="keyword">const</span> miUint&amp; numSamples );
00140   <span class="keyword">inline</span> ~<a class="code" href="structmr_1_1sampler.html">sampler</a>();
00141 
<a name="l00143"></a><a class="code" href="structmr_1_1sampler.html#a3">00143</a>   <span class="keyword">inline</span> <span class="keyword">const</span>   <span class="keywordtype">int</span> count()  { <span class="keywordflow">return</span> counter; };
00144 
00145 };
00146 
00147 
00148 
00149 
00150 
00151 <span class="comment">// ...base class for all samplers of 3d shapes...</span>
<a name="l00152"></a><a class="code" href="structmr_1_1sampler3D.html">00152</a> <span class="keyword">struct </span><a class="code" href="structmr_1_1sampler3D.html">sampler3D</a> : <span class="keyword">public</span> <a class="code" href="structmr_1_1sampler.html">sampler</a>
00153 {
<a name="l00155"></a><a class="code" href="structmr_1_1sampler3D.html#o0">00155</a>   <span class="keywordtype">double</span> samples[2];
00156 
<a name="l00158"></a><a class="code" href="structmr_1_1sampler3D.html#o1">00158</a>   miVector dir;
00159 
00161   <span class="keyword">inline</span>  <a class="code" href="structmr_1_1sampler3D.html">sampler3D</a>();
00163   <span class="keyword">inline</span>  <a class="code" href="structmr_1_1sampler3D.html">sampler3D</a>( <span class="keyword">const</span> miUint&amp; numSamples );
00164      
<a name="l00165"></a><a class="code" href="structmr_1_1sampler3D.html#a2">00165</a>   <span class="keyword">inline</span> ~<a class="code" href="structmr_1_1sampler3D.html">sampler3D</a>() {};
00166 
<a name="l00168"></a><a class="code" href="structmr_1_1sampler3D.html#a3">00168</a>   <span class="keyword">inline</span>  miVector&amp; direction() { <span class="keywordflow">return</span> dir; };
00169 
00170 };
00171 
<a name="l00173"></a><a class="code" href="classmr_1_1sphereSampler.html">00173</a> <span class="keyword">class </span><a class="code" href="classmr_1_1sphereSampler.html">sphereSampler</a> : <span class="keyword">public</span> <a class="code" href="structmr_1_1sampler3D.html">sampler3D</a>
00174 {
00175   <span class="comment">// In parameters</span>
00176   miVector <a class="code" href="mrRman__macros_8h.html#a4">N</a>;
00177   <span class="keyword">const</span> miScalar sphPercent;
00178 
00179   <span class="comment">// xyz amount for new normal</span>
00180   miVector amt;
00181 
00182 <span class="keyword">protected</span>:
00183   <span class="keyword">inline</span> <span class="keywordtype">void</span>  calculateDirection();
00184   <span class="keyword">inline</span> <span class="keywordtype">void</span> uniformDistribution();
00185 
00186 <span class="keyword">public</span>:
00193   <span class="keyword">inline</span> <a class="code" href="classmr_1_1sphereSampler.html">sphereSampler</a>( <span class="keyword">const</span> miVector&amp; Nin,
00194                         <span class="keyword">const</span> miScalar spherePercent = 1.0f );
00199   <span class="keyword">inline</span> <a class="code" href="classmr_1_1sphereSampler.html">sphereSampler</a>( <span class="keyword">const</span> miVector&amp; Nin, 
00200                         <span class="keyword">const</span> miUint&amp; numSamples,
00201                         <span class="keyword">const</span> miScalar spherePercent = 1.0f );
<a name="l00203"></a><a class="code" href="classmr_1_1sphereSampler.html#a2">00203</a>   <span class="keyword">inline</span> ~<a class="code" href="classmr_1_1sphereSampler.html">sphereSampler</a>() {};
00204 
00207   <span class="keyword">inline</span> <span class="keyword">const</span> miScalar weight();
00208 
00210   <span class="keyword">inline</span> <span class="keywordtype">bool</span> uniform( <span class="keyword">const</span> miState* <span class="keyword">const</span> state );
00211 };
00212 
00213 
<a name="l00215"></a><a class="code" href="classmr_1_1hemisphereSampler.html">00215</a> <span class="keyword">class </span><a class="code" href="classmr_1_1hemisphereSampler.html">hemisphereSampler</a> : <span class="keyword">public</span> <a class="code" href="structmr_1_1sampler3D.html">sampler3D</a>
00216 {
00217   <span class="comment">// In parameters</span>
00218   miVector <a class="code" href="mrRman__macros_8h.html#a4">N</a>;
00219 
00220   <span class="comment">// U, V reference frame of N</span>
00221   miVector U, V;
00222 
00223   <span class="comment">// Amount of translation along U, V and N</span>
00224   miVector amt;
00225 
00226 <span class="keyword">protected</span>:
00227   <span class="keyword">inline</span> <span class="keywordtype">void</span>    UVNframe();
00228 
00229   <span class="keyword">inline</span> <span class="keywordtype">void</span>  cosineDistribution();
00230   <span class="keyword">inline</span> <span class="keywordtype">void</span>  cosineDistribution( <span class="keyword">const</span> miScalar <a class="code" href="namespacemr.html#a56">max</a> );
00231 
00232 
00233   <span class="keyword">inline</span> <span class="keywordtype">void</span> uniformDistribution();
00234   <span class="keyword">inline</span> <span class="keywordtype">void</span> uniformDistribution( <span class="keyword">const</span> miScalar <a class="code" href="namespacemr.html#a56">max</a> );
00235 
00236 
00237 
00238   <span class="keyword">inline</span> <span class="keywordtype">void</span>  calculateDirection();
00239 <span class="keyword">public</span>:
00240 
00246   <span class="keyword">inline</span> <a class="code" href="classmr_1_1hemisphereSampler.html">hemisphereSampler</a>( <span class="keyword">const</span> miVector&amp; Nin );
00247      
00251   <span class="keyword">inline</span> <a class="code" href="classmr_1_1hemisphereSampler.html">hemisphereSampler</a>( <span class="keyword">const</span> miVector&amp; Nin, 
00252                             <span class="keyword">const</span> miUint&amp; numSamples );
00253   <span class="keyword">inline</span> ~<a class="code" href="classmr_1_1hemisphereSampler.html">hemisphereSampler</a>();
00254 
00255 
00258   <span class="keyword">inline</span> <span class="keywordtype">bool</span> uniform( <span class="keyword">const</span> miState* <span class="keyword">const</span> state );
00261   <span class="keyword">inline</span> <span class="keywordtype">bool</span> cosine( <span class="keyword">const</span> miState* <span class="keyword">const</span> state );
00262 
00265   <span class="keyword">inline</span> <span class="keywordtype">bool</span> uniform( <span class="keyword">const</span> miState* <span class="keyword">const</span> state,
00266                        <span class="keyword">const</span> miScalar <a class="code" href="namespacemr.html#a56">max</a> );
00269   <span class="keyword">inline</span> <span class="keywordtype">bool</span> cosine( <span class="keyword">const</span> miState* <span class="keyword">const</span> state,
00270                       <span class="keyword">const</span> miScalar <a class="code" href="namespacemr.html#a56">max</a> );
00271 
<a name="l00275"></a><a class="code" href="classmr_1_1hemisphereSampler.html#a7">00275</a>   <span class="keyword">inline</span> <span class="keyword">const</span> miScalar   weight() { <span class="keywordflow">return</span> amt.z; };
00276 };
00277 
00278 
00279 
<a name="l00281"></a><a class="code" href="classmr_1_1diskSampler.html">00281</a> <span class="keyword">class </span><a class="code" href="classmr_1_1diskSampler.html">diskSampler</a> : <span class="keyword">public</span> <a class="code" href="structmr_1_1sampler.html">sampler</a>
00282 {
00283   <span class="keywordtype">double</span> samples[2];
00284   miVector2d amt;
00285 
00286 <span class="keyword">protected</span>:
00287   <span class="keyword">inline</span> <span class="keywordtype">void</span> concentricDistribution();
00288   <span class="keyword">inline</span> <span class="keywordtype">void</span> uniformDistribution();
00289 
00290 <span class="keyword">public</span>:
00295   <span class="keyword">inline</span> <a class="code" href="classmr_1_1diskSampler.html">diskSampler</a>();
00298   <span class="keyword">inline</span> <a class="code" href="classmr_1_1diskSampler.html">diskSampler</a>( <span class="keyword">const</span> miUint&amp; numSamples );
<a name="l00299"></a><a class="code" href="classmr_1_1diskSampler.html#a2">00299</a>   <span class="keyword">inline</span> ~<a class="code" href="classmr_1_1diskSampler.html">diskSampler</a>() {};
00300 
00302   <span class="keyword">inline</span> <span class="keywordtype">bool</span>    uniform( <span class="keyword">const</span> miState* <span class="keyword">const</span> );
00304   <span class="keyword">inline</span> <span class="keywordtype">bool</span> concentric( <span class="keyword">const</span> miState* <span class="keyword">const</span> );
00305 
<a name="l00307"></a><a class="code" href="classmr_1_1diskSampler.html#a5">00307</a>   <span class="keyword">inline</span> <span class="keyword">const</span> miVector2d&amp; position() { <span class="keywordflow">return</span> amt; };
00308 };
00309 
00310 
00311 <a class="code" href="mrMacros_8h.html#a1">END_NAMESPACE</a>( mr )
00312 
00313 
00314 
00315 #include <span class="stringliteral">"mrSampler.inl"</span>
00316 
00317 
00318 <span class="preprocessor">#endif</span>
00319 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 22 18:29:24 2004 for mrClasses by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>

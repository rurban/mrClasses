<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mrClasses: mrProfile.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mrProfile.h</h1><a href="mrProfile_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//  Copyright (c) 2004, Gonzalo Garramuno</span>
00003 <span class="comment">//</span>
00004 <span class="comment">//  All rights reserved.</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  Redistribution and use in source and binary forms, with or without</span>
00007 <span class="comment">//  modification, are permitted provided that the following conditions are</span>
00008 <span class="comment">//  met:</span>
00009 <span class="comment">//  *       Redistributions of source code must retain the above copyright</span>
00010 <span class="comment">//  notice, this list of conditions and the following disclaimer.</span>
00011 <span class="comment">//  *       Redistributions in binary form must reproduce the above</span>
00012 <span class="comment">//  copyright notice, this list of conditions and the following disclaimer</span>
00013 <span class="comment">//  in the documentation and/or other materials provided with the</span>
00014 <span class="comment">//  distribution.</span>
00015 <span class="comment">//  *       Neither the name of Gonzalo Garramuno nor the names of</span>
00016 <span class="comment">//  its other contributors may be used to endorse or promote products derived</span>
00017 <span class="comment">//  from this software without specific prior written permission. </span>
00018 <span class="comment">//</span>
00019 <span class="comment">//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
00020 <span class="comment">//  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
00021 <span class="comment">//  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
00022 <span class="comment">//  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
00023 <span class="comment">//  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00024 <span class="comment">//  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00025 <span class="comment">//  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
00026 <span class="comment">//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
00027 <span class="comment">//  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
00028 <span class="comment">//  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
00029 <span class="comment">//  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00030 <span class="comment">//</span>
00031 
00032 <span class="preprocessor">#ifndef mrProfile_h</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define mrProfile_h</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#include "<a class="code" href="mrMacros_8h.html">mrMacros.h</a>"</span>
00036 <span class="preprocessor">#include &lt;ctime&gt;</span>
00037 
00038 
00039 <a class="code" href="mrMacros_8h.html#a0">BEGIN_NAMESPACE</a>( mr );
00040 
00041 <span class="comment">// GetTickCount() on Windows is a tad faster than clock()</span>
00042 <span class="preprocessor">#ifdef WIN32</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#include &lt;windows.h&gt;</span>
00044 <span class="preprocessor">#endif // WIN32</span>
00045 <span class="preprocessor"></span>
00046 
00064 <span class="comment">//</span>
<a name="l00065"></a><a class="code" href="classmr_1_1timer.html">00065</a> <span class="keyword">class </span><a class="code" href="classmr_1_1timer.html">timer</a>
00066 {
00067   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kSECS = CLOCKS_PER_SEC;
00068   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kMINS = 60 * kSECS;
00069   <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> kHRS  = 60 * kMINS;
00070 
00071   miUint mLine;
00072   clock_t mStart;
00073   clock_t mDuration;
00074 
00075   <span class="keywordtype">void</span> convert( clock_t t, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; h, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; m,
00076                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; s, <span class="keywordtype">double</span>&amp; ms )
00077   {
00078     h  = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) t / kHRS;
00079     t -= h * kHRS;
00080     m  = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) t / kMINS;
00081     t -= m * kMINS;
00082     s  = (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) t / kSECS;
00083     t -= s * kSECS;
00084     ms = (<span class="keywordtype">double</span>) t / kSECS * 1000;
00085   }
00086 
00087 <span class="comment">// GetTickCount() on Windows is a tad faster than clock()</span>
00088 <span class="preprocessor">#ifdef WIN32</span>
00089 <span class="preprocessor"></span>     <span class="keyword">inline</span> clock_t <a class="code" href="mrRman__macros_8h.html#a12">time</a>()  { <span class="keywordflow">return</span> GetTickCount(); }
00090 <span class="preprocessor">#else</span>
00091 <span class="preprocessor"></span>     <span class="keyword">inline</span> clock_t <a class="code" href="mrRman__macros_8h.html#a12">time</a>()  { <span class="keywordflow">return</span> clock(); }
00092 <span class="preprocessor">#endif // WIN32</span>
00093 <span class="preprocessor"></span>
00094 <span class="keyword">public</span>:
<a name="l00095"></a><a class="code" href="classmr_1_1timer.html#a0">00095</a>      <a class="code" href="classmr_1_1timer.html">timer</a>( miUint l = 0 ) : 
00096      mLine(l), mStart( <a class="code" href="mrRman__macros_8h.html#a12">time</a>() )
00097      {}
00098      
<a name="l00099"></a><a class="code" href="classmr_1_1timer.html#a1">00099</a>      <a class="code" href="classmr_1_1timer.html">timer</a>( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">timer</a>&amp; b ) :
00100      mLine( b.mLine ), mStart( b.mStart ), mDuration( b.mDuration )
00101      {
00102      }
00103      
<a name="l00104"></a><a class="code" href="classmr_1_1timer.html#a2">00104</a>      ~<a class="code" href="classmr_1_1timer.html">timer</a>()
00105      {
00106      }
00107 
<a name="l00108"></a><a class="code" href="classmr_1_1timer.html#a3">00108</a>      <span class="keywordtype">void</span> print()
00109      {
00110         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> h,m,s; <span class="keywordtype">double</span> ms;  
00111         convert(mDuration, h, m, s, ms);
00112         mi_info(<span class="stringliteral">"%d profiled: %d hs. %d mins. %d secs. %g ms."</span>,
00113                 mLine, h, m, s, ms);
00114      }
00115 
<a name="l00116"></a><a class="code" href="classmr_1_1timer.html#a4">00116</a>      <span class="keywordtype">void</span> start()
00117      {
00118         mStart = <a class="code" href="mrRman__macros_8h.html#a12">time</a>();
00119         mDuration = 0;
00120      }
00121      
<a name="l00122"></a><a class="code" href="classmr_1_1timer.html#a5">00122</a>      <span class="keywordtype">void</span> stop()
00123      {
00124         mDuration = <a class="code" href="mrRman__macros_8h.html#a12">time</a>() - mStart;
00125      }
00126      
00127      
<a name="l00128"></a><a class="code" href="classmr_1_1timer.html#a6">00128</a>      <span class="keywordtype">bool</span> operator&gt;( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">timer</a>&amp; b )<span class="keyword"> const</span>
00129 <span class="keyword">     </span>{
00130         <span class="keywordflow">return</span> ( mDuration &gt; b.<a class="code" href="classmr_1_1timer.html#r2">mDuration</a> ); 
00131      }
00132      
<a name="l00133"></a><a class="code" href="classmr_1_1timer.html#a7">00133</a>      <span class="keywordtype">bool</span> operator&lt;( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">timer</a>&amp; b )<span class="keyword"> const</span>
00134 <span class="keyword">     </span>{
00135         <span class="keywordflow">return</span> ( mDuration &lt; b.<a class="code" href="classmr_1_1timer.html#r2">mDuration</a> ); 
00136      }
00137 
00138      
<a name="l00139"></a><a class="code" href="classmr_1_1timer.html#a8">00139</a>      <a class="code" href="classmr_1_1timer.html">timer</a>&amp; <a class="code" href="mrOperators_8h.html#a45">operator+=</a>( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">timer</a>&amp; b )
00140      {
00141         mDuration += b.<a class="code" href="classmr_1_1timer.html#r2">mDuration</a>;
00142         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00143      }
00144 
<a name="l00145"></a><a class="code" href="classmr_1_1timer.html#a9">00145</a>      <a class="code" href="classmr_1_1timer.html">timer</a>&amp; <a class="code" href="mrOperators_8h.html#a49">operator-=</a>( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">timer</a>&amp; b )
00146      {
00147         mDuration -= b.<a class="code" href="classmr_1_1timer.html#r2">mDuration</a>;
00148         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
00149      }
00150 };
00151 
00152 
<a name="l00166"></a><a class="code" href="classmr_1_1simple__timer.html">00166</a> <span class="keyword">class </span><a class="code" href="classmr_1_1simple__timer.html">simple_timer</a> : <span class="keyword">public</span> <a class="code" href="classmr_1_1timer.html">timer</a>
00167 {
00168      <a class="code" href="classmr_1_1simple__timer.html">simple_timer</a>( <span class="keywordtype">int</span> l ) :
00169      <a class="code" href="classmr_1_1timer.html">timer</a>(l)
00170      {
00171      }
00172 
00173      ~<a class="code" href="classmr_1_1simple__timer.html">simple_timer</a>()
00174      {
00175         stop();
00176         print();
00177      }
00178 };
00179 
00180 
00181 <a class="code" href="mrMacros_8h.html#a1">END_NAMESPACE</a>( mr );
00182 
00183      
<a name="l00184"></a><a class="code" href="mrProfile_8h.html#a1">00184</a> <span class="keyword">inline</span> <a class="code" href="classmr_1_1timer.html">mr::timer</a> <a class="code" href="mrProfile_8h.html#a1">operator+</a>( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">mr::timer</a>&amp; a, <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">mr::timer</a>&amp; b )
00185 {
00186    <a class="code" href="classmr_1_1timer.html">mr::timer</a> c(a); c += b; <span class="keywordflow">return</span> c;
00187 }
00188 
<a name="l00189"></a><a class="code" href="mrProfile_8h.html#a2">00189</a> <span class="keyword">inline</span> <a class="code" href="classmr_1_1timer.html">mr::timer</a> <a class="code" href="mrProfile_8h.html#a2">operator-</a>( <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">mr::timer</a>&amp; a, <span class="keyword">const</span> <a class="code" href="classmr_1_1timer.html">mr::timer</a>&amp; b )
00190 {
00191    <a class="code" href="classmr_1_1timer.html">mr::timer</a> c(a); c -= b; <span class="keywordflow">return</span> c;
00192 }
00193 
00194 
<a name="l00195"></a><a class="code" href="mrProfile_8h.html#a0">00195</a> <span class="preprocessor">#define MR_TIME_IT  mr::simple_timer  timer ## __LINE__ ( __LINE__ );</span>
00196 <span class="preprocessor"></span>
00197 <span class="preprocessor">#endif  // mrProfile_h</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 22 18:29:24 2004 for mrClasses by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>

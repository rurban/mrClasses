<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mrClasses: mrFastMath.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mrFastMath.h</h1><a href="mrFastMath_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//  Copyright (c) 2004, Gonzalo Garramuno</span>
00003 <span class="comment">//</span>
00004 <span class="comment">//  All rights reserved.</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  Redistribution and use in source and binary forms, with or without</span>
00007 <span class="comment">//  modification, are permitted provided that the following conditions are</span>
00008 <span class="comment">//  met:</span>
00009 <span class="comment">//  *       Redistributions of source code must retain the above copyright</span>
00010 <span class="comment">//  notice, this list of conditions and the following disclaimer.</span>
00011 <span class="comment">//  *       Redistributions in binary form must reproduce the above</span>
00012 <span class="comment">//  copyright notice, this list of conditions and the following disclaimer</span>
00013 <span class="comment">//  in the documentation and/or other materials provided with the</span>
00014 <span class="comment">//  distribution.</span>
00015 <span class="comment">//  *       Neither the name of Gonzalo Garramuno nor the names of</span>
00016 <span class="comment">//  its other contributors may be used to endorse or promote products derived</span>
00017 <span class="comment">//  from this software without specific prior written permission. </span>
00018 <span class="comment">//</span>
00019 <span class="comment">//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
00020 <span class="comment">//  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
00021 <span class="comment">//  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
00022 <span class="comment">//  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
00023 <span class="comment">//  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00024 <span class="comment">//  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00025 <span class="comment">//  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
00026 <span class="comment">//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
00027 <span class="comment">//  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
00028 <span class="comment">//  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
00029 <span class="comment">//  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00030 <span class="comment">//</span>
00031 
00033 <span class="comment">//</span>
00034 <span class="comment">// mrFastMath.h</span>
00035 <span class="comment">//</span>
00036 <span class="comment">// This file contains a class that allows accelerating some typical</span>
00037 <span class="comment">// math functions, by using IEEE tricks.</span>
00038 <span class="comment">// </span>
00039 <span class="comment">// After testing Apple sqrt() and others, I came to the conclusion that the</span>
00040 <span class="comment">// system sqrt() on Windows, at least, is more efficient and precise.</span>
00041 <span class="comment">//</span>
00042 <span class="comment">// Portions of this code are largely based on David Eberly's Magic Software,</span>
00043 <span class="comment">// and is used under the WildMagic License Agreement.</span>
00044 <span class="comment">//</span>
00045 <span class="comment">// Magic Software, Inc.</span>
00046 <span class="comment">// http://www.magic-software.com</span>
00047 <span class="comment">// http://www.wild-magic.com</span>
00048 <span class="comment">// Copyright (c) 2003.  All Rights Reserved</span>
00049 
00050 <span class="preprocessor">#ifndef mrFastMath_h</span>
00051 <span class="preprocessor"></span><span class="preprocessor">#define mrFastMath_h</span>
00052 <span class="preprocessor"></span>
00053 <span class="preprocessor">#ifndef mrMacros_h</span>
00054 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="mrMacros_8h.html">mrMacros.h</a>"</span>
00055 <span class="preprocessor">#endif</span>
00056 <span class="preprocessor"></span>
00057 <span class="preprocessor">#ifndef mrMemory_h</span>
00058 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="mrMemory_8h.html">mrMemory.h</a>"</span>
00059 <span class="preprocessor">#endif</span>
00060 <span class="preprocessor"></span>
00061 
00062 <a class="code" href="mrMacros_8h.html#a0">BEGIN_NAMESPACE</a>( mr )
00063 
00064 
00065 
00066 
00067 <span class="keyword">template</span> &lt; <span class="keyword">class</span> T &gt;
<a name="l00068"></a><a class="code" href="classmr_1_1fastmath.html">00068</a> <span class="keyword">class </span><a class="code" href="classmr_1_1fastmath.html">fastmath</a>
00069 {
00070      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> fixmagic;
00071      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span>    shiftamt;                    
00072 <span class="preprocessor">#if BigEndian_</span>
00073 <span class="preprocessor"></span>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> iexp_ = 0;
00074      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> iman_ = 1;
00075 <span class="preprocessor">#else</span>
00076 <span class="preprocessor"></span>     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> iexp_ = 1;
00077      <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> iman_ = 0;
00078 <span class="preprocessor">#endif //BigEndian_</span>
00079 <span class="preprocessor"></span>
00080    <span class="keyword">public</span>:
00085      <span class="keyword">inline</span> <span class="keyword">static</span> T sin0( <span class="keyword">const</span> T x );
00086      
00091      <span class="keyword">inline</span> <span class="keyword">static</span> T sin1( <span class="keyword">const</span> T x );
00092 
00096      <span class="keyword">inline</span> <span class="keyword">static</span> T cos0( <span class="keyword">const</span> T x );
00097      
00101      <span class="keyword">inline</span> <span class="keyword">static</span> T cos1( <span class="keyword">const</span> T x );
00102      
00106      <span class="keyword">inline</span> <span class="keyword">static</span> T tan0( <span class="keyword">const</span> T x );
00107      
00111      <span class="keyword">inline</span> <span class="keyword">static</span> T tan1( <span class="keyword">const</span> T x );
00112      
00116      <span class="keyword">inline</span> <span class="keyword">static</span> T asin( <span class="keyword">const</span> T x );
00117 
00118      
00122      <span class="keyword">inline</span> <span class="keyword">static</span> T acos( <span class="keyword">const</span> T x );
00123 
00127      <span class="keyword">inline</span> <span class="keyword">static</span> T atan0( <span class="keyword">const</span> T x );
00128      
00132      <span class="keyword">inline</span> <span class="keyword">static</span> T atan1( <span class="keyword">const</span> T x );
00133      
00135      <span class="keyword">inline</span> <span class="keyword">static</span> T invsqrt( T x );
00136 
00138      <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">int</span> floor( T x );
00139      
00141      <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">int</span>  ceil( T x );
00142 };
00143 
00144 
00145 <span class="comment">//----------------------------------------------------------------------------</span>
00146 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00147"></a><a class="code" href="classmr_1_1fastmath.html#e0">00147</a> <span class="keyword">inline</span> T <a class="code" href="classmr_1_1fastmath.html">fastmath&lt; T &gt;::sin0</a>( <span class="keyword">const</span> T x )
00148 {
00149    T x2 = x*x;
00150    T r = static_cast&lt;T&gt;(7.61e-03);
00151    r *= x2;
00152    r -= static_cast&lt;T&gt;(1.6605e-01);
00153    r *= x2;
00154    r += static_cast&lt;T&gt;(1.0);
00155    r *= x;
00156    <span class="keywordflow">return</span> r;
00157 }
00158 
00159 <span class="comment">//----------------------------------------------------------------------------</span>
00160 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00161"></a><a class="code" href="classmr_1_1fastmath.html#e1">00161</a> <span class="keyword">inline</span> T <a class="code" href="classmr_1_1fastmath.html">fastmath&lt; T &gt;::sin1</a>( <span class="keyword">const</span> T x )
00162 {
00163    T x2 = x*x;
00164    T r = -static_cast&lt;T&gt;(2.39e-08);
00165    r *= x2;
00166    r += static_cast&lt;T&gt;(2.7526e-06);
00167    r *= x2;
00168    r -= static_cast&lt;T&gt;(1.98409e-04);
00169    r *= x2;
00170    r += static_cast&lt;T&gt;(8.3333315e-03);
00171    r *= x2;
00172    r -= static_cast&lt;T&gt;(1.666666664e-01);
00173    r *= x2;
00174    r += static_cast&lt;T&gt;(1.0);
00175    r *= x;
00176    <span class="keywordflow">return</span> r;
00177 }
00178 
00179 <span class="comment">//----------------------------------------------------------------------------</span>
00180 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00181"></a><a class="code" href="classmr_1_1fastmath.html#e2">00181</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::cos0</a>(<span class="keyword">const</span> T x)
00182 {
00183     T  x2 = x*x;
00184     T  r = static_cast&lt;T&gt;(3.705e-02);
00185     r *= x2;
00186     r -= static_cast&lt;T&gt;(4.967e-01);
00187     r *= x2;
00188     r += static_cast&lt;T&gt;(1.0);
00189     <span class="keywordflow">return</span> r;
00190 }
00191 <span class="comment">//----------------------------------------------------------------------------</span>
00192 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00193"></a><a class="code" href="classmr_1_1fastmath.html#e3">00193</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::cos1</a>(<span class="keyword">const</span> T x)
00194 {
00195     <span class="keywordtype">double</span>  x2 = x*x;
00196     <span class="keywordtype">double</span>  r = -static_cast&lt;T&gt;(2.605e-07);
00197     r *= x2;
00198     r += static_cast&lt;T&gt;(2.47609e-05);
00199     r *= x2;
00200     r -= static_cast&lt;T&gt;(1.3888397e-03);
00201     r *= x2;
00202     r += static_cast&lt;T&gt;(4.16666418e-02);
00203     r *= x2;
00204     r -= static_cast&lt;T&gt;(4.999999963e-01);
00205     r *= x2;
00206     r += static_cast&lt;T&gt;(1.0);
00207     <span class="keywordflow">return</span> (T)r;
00208 }
00209 <span class="comment">//----------------------------------------------------------------------------</span>
00210 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00211"></a><a class="code" href="classmr_1_1fastmath.html#e4">00211</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::tan0</a>(<span class="keyword">const</span> T x)
00212 {
00213     T  x2 = x*x;
00214     T  r = static_cast&lt;T&gt;(2.033e-01);
00215     r *= x2;
00216     r += static_cast&lt;T&gt;(3.1755e-01);
00217     r *= x2;
00218     r += static_cast&lt;T&gt;(1.0);
00219     r *= x;
00220     <span class="keywordflow">return</span> r;
00221 }
00222 <span class="comment">//----------------------------------------------------------------------------</span>
00223 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00224"></a><a class="code" href="classmr_1_1fastmath.html#e5">00224</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::tan1</a>(<span class="keyword">const</span> T x)
00225 {
00226     T  x2 = x*x;
00227     T  r = static_cast&lt;T&gt;(9.5168091e-03);
00228     r *= x2;
00229     r += static_cast&lt;T&gt;(2.900525e-03);
00230     r *= x2;
00231     r += static_cast&lt;T&gt;(2.45650893e-02);
00232     r *= x2;
00233     r += static_cast&lt;T&gt;(5.33740603e-02);
00234     r *= x2;
00235     r += static_cast&lt;T&gt;(1.333923995e-01);
00236     r *= x2;
00237     r += static_cast&lt;T&gt;(3.333314036e-01);
00238     r *= x2;
00239     r += static_cast&lt;T&gt;(1.0);
00240     r *= x;
00241     <span class="keywordflow">return</span> r;
00242 }
00243 
00254 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00255"></a><a class="code" href="classmr_1_1fastmath.html#e10">00255</a> <span class="keyword">inline</span> T <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::invsqrt</a>( T x )
00256 {
00257    <a class="code" href="mrAssert_8h.html#a0">mrASSERT</a>( x &gt; 0 );
00258   <span class="comment">//@todo:  This routine was designed for 'float'.  Come up with an</span>
00259   <span class="comment">// equivalent one for 'double' and specialize the templates for 'float'</span>
00260   <span class="comment">// and 'double'.</span>
00261   T xhalf = 0.5f*x;
00262   <span class="keywordtype">int</span> i = *(<span class="keywordtype">int</span>*)&amp;x;
00263   i = 0x5f375a86 - ( i &gt;&gt; 1 );  <span class="comment">// This line hides a LOT of math!</span>
00264   x = *(miScalar*)&amp;i;
00265   <span class="comment">// do two Newton steps</span>
00266   x = x * ( 1.5f - xhalf * x * x);
00267   x = x * ( 1.5f - xhalf * x * x);
00268   <span class="keywordflow">return</span> x;
00269 }
00270 <span class="comment">//----------------------------------------------------------------------------</span>
00271 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00272"></a><a class="code" href="classmr_1_1fastmath.html#e6">00272</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::asin</a>(<span class="keyword">const</span> T x)
00273 {
00274     T  root = <a class="code" href="structmr_1_1math.html">math&lt;T&gt;::sqrt</a>(static_cast&lt;T&gt;(1.0)-x);
00275     T  r = -static_cast&lt;T&gt;(0.0187293);
00276     r *= x;
00277     r += static_cast&lt;T&gt;(0.0742610);
00278     r *= x;
00279     r -= static_cast&lt;T&gt;(0.2121144);
00280     r *= x;
00281     r += static_cast&lt;T&gt;(1.5707288);
00282     r = M_PI_2 - root*r;
00283     <span class="keywordflow">return</span> r;
00284 }
00285 <span class="comment">//----------------------------------------------------------------------------</span>
00286 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00287"></a><a class="code" href="classmr_1_1fastmath.html#e7">00287</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::acos</a>(<span class="keyword">const</span> T x)
00288 {
00289     T  root = <a class="code" href="structmr_1_1math.html">math&lt;T&gt;::sqrt</a>(static_cast&lt;T&gt;(1.0)-x);
00290     T  r = -static_cast&lt;T&gt;(0.0187293);
00291     r *= x;
00292     r += static_cast&lt;T&gt;(0.0742610);
00293     r *= x;
00294     r -= static_cast&lt;T&gt;(0.2121144);
00295     r *= x;
00296     r += static_cast&lt;T&gt;(1.5707288);
00297     r *= root;
00298     <span class="keywordflow">return</span> r;
00299 }
00300 <span class="comment">//----------------------------------------------------------------------------</span>
00301 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00302"></a><a class="code" href="classmr_1_1fastmath.html#e8">00302</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::atan0</a>(<span class="keyword">const</span> T x)
00303 {
00304     T  x2 = x*x;
00305     T  r = static_cast&lt;T&gt;(0.0208351);
00306     r *= x2;
00307     r -= static_cast&lt;T&gt;(0.085133);
00308     r *= x2;
00309     r += static_cast&lt;T&gt;(0.180141);
00310     r *= x2;
00311     r -= static_cast&lt;T&gt;(0.3302995);
00312     r *= x2;
00313     r += static_cast&lt;T&gt;(0.999866);
00314     r *= x;
00315     <span class="keywordflow">return</span> r;
00316 }
00317 <span class="comment">//----------------------------------------------------------------------------</span>
00318 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T &gt;
<a name="l00319"></a><a class="code" href="classmr_1_1fastmath.html#e9">00319</a> <span class="keyword">inline</span> T  <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;T&gt;::atan1</a>(<span class="keyword">const</span> T x)
00320 {
00321     T  x2 = x*x;
00322     T  r = static_cast&lt;T&gt;(0.0028662257);
00323     r *= x2;
00324     r -= static_cast&lt;T&gt;(0.0161657367);
00325     r *= x2;
00326     r += static_cast&lt;T&gt;(0.0429096138);
00327     r *= x2;
00328     r -= static_cast&lt;T&gt;(0.0752896400);
00329     r *= x2;
00330     r += static_cast&lt;T&gt;(0.1065626393);
00331     r *= x2;
00332     r -= static_cast&lt;T&gt;(0.1420889944);
00333     r *= x2;
00334     r += static_cast&lt;T&gt;(0.1999355085);
00335     r *= x2;
00336     r -= static_cast&lt;T&gt;(0.3333314528);
00337     r *= x2;
00338     r += static_cast&lt;T&gt;(1.0);
00339     r *= x;
00340     <span class="keywordflow">return</span> r;
00341 }
00342 
00345 <span class="comment">//----------------------------------------------------------------------------</span>
00347 <span class="comment"></span><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
00348 <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classmr_1_1fastmath.html">fastmath&lt; T &gt;</a>::fixmagic = 68719476736.0 * 1.5;
00349 
00351 <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
00352 <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classmr_1_1fastmath.html">fastmath&lt; T &gt;</a>::shiftamt = 16;
00353 
00354 <span class="comment">//----------------------------------------------------------------------------</span>
00355 <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classmr_1_1fastmath.html">fastmath&lt;double&gt;::floor</a>(<span class="keywordtype">double</span> val)
00356 {
00357    val += fixmagic;
00358    <span class="keywordflow">return</span> ((<span class="keywordtype">int</span>*)&amp;val)[iman_] &gt;&gt; shiftamt; 
00359 }
00360 
00361 <span class="keyword">inline</span> <span class="keywordtype">int</span> fastmath&lt;float&gt;::floor(<span class="keywordtype">float</span> val)
00362 {
00363    <span class="keywordflow">return</span> fastmath&lt;double&gt;::floor((<span class="keywordtype">double</span>)val);
00364 }
00365 
00366 <span class="comment">//----------------------------------------------------------------------------</span>
00367 <span class="keyword">inline</span> <span class="keywordtype">int</span> fastmath&lt;double&gt;::ceil(<span class="keywordtype">double</span> val)
00368 {
00369    val += 0.5;
00370    <span class="keywordflow">return</span> fastmath&lt;double&gt;::floor((<span class="keywordtype">double</span>)val);
00371 }
00372 
00373 <span class="keyword">inline</span> <span class="keywordtype">int</span> fastmath&lt;float&gt;::ceil(<span class="keywordtype">float</span> val)
00374 {
00375    val += 0.5f;
00376    <span class="keywordflow">return</span> fastmath&lt;double&gt;::floor((<span class="keywordtype">double</span>)val);
00377 }
00378 
00379 
00380 <a class="code" href="mrMacros_8h.html#a1">END_NAMESPACE</a>( mr )
00381 
00382 
00383 #endif <span class="comment">// mrFastMath_h</span>
00384 
00385 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 22 18:29:23 2004 for mrClasses by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mrClasses: mrPointCache.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.5 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>mrPointCache.h</h1><a href="mrPointCache_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">//</span>
00002 <span class="comment">//  Copyright (c) 2004, Gonzalo Garramuno</span>
00003 <span class="comment">//</span>
00004 <span class="comment">//  All rights reserved.</span>
00005 <span class="comment">//</span>
00006 <span class="comment">//  Redistribution and use in source and binary forms, with or without</span>
00007 <span class="comment">//  modification, are permitted provided that the following conditions are</span>
00008 <span class="comment">//  met:</span>
00009 <span class="comment">//  *       Redistributions of source code must retain the above copyright</span>
00010 <span class="comment">//  notice, this list of conditions and the following disclaimer.</span>
00011 <span class="comment">//  *       Redistributions in binary form must reproduce the above</span>
00012 <span class="comment">//  copyright notice, this list of conditions and the following disclaimer</span>
00013 <span class="comment">//  in the documentation and/or other materials provided with the</span>
00014 <span class="comment">//  distribution.</span>
00015 <span class="comment">//  *       Neither the name of Gonzalo Garramuno nor the names of</span>
00016 <span class="comment">//  its other contributors may be used to endorse or promote products derived</span>
00017 <span class="comment">//  from this software without specific prior written permission. </span>
00018 <span class="comment">//</span>
00019 <span class="comment">//  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
00020 <span class="comment">//  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
00021 <span class="comment">//  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
00022 <span class="comment">//  A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
00023 <span class="comment">//  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00024 <span class="comment">//  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
00025 <span class="comment">//  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
00026 <span class="comment">//  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
00027 <span class="comment">//  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
00028 <span class="comment">//  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
00029 <span class="comment">//  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00030 <span class="comment">//</span>
00031 
00032 <span class="preprocessor">#ifndef mrPointCache_h</span>
00033 <span class="preprocessor"></span><span class="preprocessor">#define mrPointCache_h</span>
00034 <span class="preprocessor"></span>
00035 <span class="preprocessor">#include &lt;map&gt;</span>
00036 <span class="preprocessor">#include &lt;algorithm&gt;</span>  <span class="comment">// for_each</span>
00037 
00038 <span class="preprocessor">#ifndef SHADER_H</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#include "shader.h"</span>
00040 <span class="preprocessor">#endif</span>
00041 <span class="preprocessor"></span>
00042 <span class="preprocessor">#ifndef mrFunctors_h</span>
00043 <span class="preprocessor"></span><span class="preprocessor">#include "<a class="code" href="mrFunctors_8h.html">mrFunctors.h</a>"</span>
00044 <span class="preprocessor">#endif</span>
00045 <span class="preprocessor"></span>
00046 
00047 
00048 <a class="code" href="mrMacros_8h.html#a0">BEGIN_NAMESPACE</a>( mr )
00049 
00050 
00051 
00052 
00053 
00054 
00055 
00056 
00057 
00058 
00059 
00060 
00061 
00062 
00063 
00064 
00065 
00066 
00067 
00068 
00069 
00070 
00071 
00072 
00073 
00074 
00075 
00076 
00077 
00078 
00079 
00080 
00081 
00082 
00083 
00084 
00085 
00086 
00087 
00088 
00089 
00090 
00091 
00092 
00093 
00094 
00095 
00096 
00097 
00098 
<a name="l00099"></a><a class="code" href="classmr_1_1PointCache.html">00099</a> <span class="keyword">class </span><a class="code" href="classmr_1_1PointCache.html">PointCache</a>
00100 {
00101    <span class="keyword">protected</span>:
<a name="l00102"></a><a class="code" href="classmr_1_1PointCache.html#x0">00102</a>      <span class="keyword">typedef</span> std::map&lt; miVector, void*, lessXYZOp &gt; <a class="code" href="classmr_1_1PointCache.html#x0">cacheType</a>;
00103 
00104    <span class="keyword">public</span>:
00105 
00106 
<a name="l00108"></a><a class="code" href="classmr_1_1PointCache.html#a0">00108</a>      <span class="keyword">inline</span> <span class="keywordtype">void</span> flush()
00109      {
00110         <span class="keywordflow">if</span> (m_clean)
00111            std::for_each( m_cache.begin(), m_cache.end(),
00112                           <a class="code" href="structmr_1_1deleteMapIteratorData.html">deleteMapIteratorData</a>() );
00113         m_cache.clear();
00114      }
00115      
<a name="l00118"></a><a class="code" href="classmr_1_1PointCache.html#a1">00118</a>      <a class="code" href="classmr_1_1PointCache.html">PointCache</a>( <span class="keywordtype">bool</span> clean = <span class="keyword">true</span> ) :
00119      m_clean( clean )
00120      {};
00121 
<a name="l00122"></a><a class="code" href="classmr_1_1PointCache.html#a2">00122</a>      ~<a class="code" href="classmr_1_1PointCache.html">PointCache</a>()
00123      {
00124         flush();
00125      }
00126 
<a name="l00128"></a><a class="code" href="classmr_1_1PointCache.html#a3">00128</a>      <span class="keyword">inline</span> <span class="keywordtype">void</span> insert( <span class="keyword">const</span> miVector&amp; P, <span class="keywordtype">void</span>* data )
00129      {
00130         m_cache.insert( std::make_pair( <a class="code" href="mrRman__macros_8h.html#a3">P</a>, data ) );
00131      }
00132      
<a name="l00135"></a><a class="code" href="classmr_1_1PointCache.html#a4">00135</a>      <span class="keyword">inline</span> <span class="keywordtype">void</span>* at( <span class="keyword">const</span> miVector&amp; P )
00136      {
00137         cacheType::const_iterator i = m_cache.find( <a class="code" href="mrRman__macros_8h.html#a3">P</a> );
00138         <span class="keywordflow">if</span> ( i == m_cache.end() )
00139         {
00140            <a class="code" href="mrStream_8h.html#a3">mr_fatal</a>(<span class="stringliteral">"Point "</span> &lt;&lt; <a class="code" href="mrRman__macros_8h.html#a3">P</a> &lt;&lt; <span class="stringliteral">" not in point cache!"</span>);
00141         }
00142         <span class="keywordflow">else</span> <span class="keywordflow">return</span> i-&gt;second;
00143      }
00144 
<a name="l00147"></a><a class="code" href="classmr_1_1PointCache.html#a5">00147</a>      <span class="keyword">inline</span> <span class="keywordtype">void</span>* operator[]( <span class="keyword">const</span> miVector&amp; P )
00148      {
00149         cacheType::const_iterator i = m_cache.find( <a class="code" href="mrRman__macros_8h.html#a3">P</a> );
00150         <span class="keywordflow">if</span> ( i == m_cache.end() )
00151            <span class="keywordflow">return</span> NULL;  <span class="comment">// NOT FOUND!</span>
00152         <span class="keywordflow">else</span> <span class="keywordflow">return</span> i-&gt;second;
00153      }
00154 
00155 
00156 
00159      <span class="keyword">template</span>&lt; <span class="keyword">typename</span> T &gt;
<a name="l00160"></a><a class="code" href="classmr_1_1PointCache.html#a6">00160</a>      <span class="keyword">inline</span> <span class="keywordtype">void</span> data( <span class="keyword">const</span> miState* <span class="keyword">const</span> state,
00161                        T* data[3] )
00162      {
00163         miVector* p[3];
00164         mi_tri_vectors(const_cast&lt;miState*&gt;(state), <span class="charliteral">'p'</span>, 0,
00165                        &amp;p[0], &amp;p[1], &amp;p[2]);
00166         data[0] = static_cast&lt; T* &gt;( (*this)[*(p[0])] );
00167         data[1] = static_cast&lt; T* &gt;( (*this)[*(p[1])] );
00168         data[2] = static_cast&lt; T* &gt;( (*this)[*(p[2])] );
00169      }
00170      
00171    <span class="keyword">private</span>:
00172      <span class="keywordtype">bool</span>   m_clean;
00173      cacheType m_cache;
00174 };
00175 
00176 
00177 
00178 
00179 <a class="code" href="mrMacros_8h.html#a1">END_NAMESPACE</a>( mr )
00180 
00181 #endif <span class="comment">// mrPointCache_h</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 22 18:29:24 2004 for mrClasses by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.5 </small></address>
</body>
</html>
